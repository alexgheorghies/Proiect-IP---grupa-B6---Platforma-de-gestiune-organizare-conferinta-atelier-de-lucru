{{velocity}}
  $xwiki.jsfx.use('uicomponents/widgets/upload.js', true)
  $xwiki.ssfx.use('uicomponents/widgets/upload.css', true)


{{html}}
  <form enctype="multipart/form-data" method="post">

    <div>
      Title<br></br>
      <input type="text" name="titlu" size="20" placeholder="Insert title" required="required"/>
      <br></br><br></br>

      Content<br></br>
      <input type="file" name="filepath" id="uploadfile" action="${doc.getURL('upload')}" />
      <input type="hidden" name="form_token" value="$!{services.csrf.getToken()}"/>
      <br></br><br></br>

      Description<br></br>
      <textarea name="description" id="txtArea" rows="5" cols="70" placeholder="Insert description"></textarea>
      <br></br><br></br>

      Number Of Authors<br></br>
      <input type="number" name="nrauthors" step="1" min="1" max = "20" oninput="handlerAuthors(this)" required/>
      <br></br><br></br>

      <div id = "authors"></div>
    </div>

    <script type="text/javascript">
      //<![CDATA[
         function getInnerHtml(requested, requstId){
            return requested + "  " +
                   "<input type='text' name='" + requested.toLowerCase() + requstId + "' size='20' placeholder='Insert " +                                      requested.toLowerCase() + "' required/></br>";
         }

         function handlerAuthors(that){
           document.getElementById('authors').innerHTML = "";

           var indexAuthor;
           for(indexAuthor = 1; indexAuthor <= that.value; indexAuthor ++){
               var newdiv = document.createElement('div');
               newdiv.setAttribute("id", "author" + indexAuthor);

               newdiv.innerHTML =  "<b>Author " + indexAuthor + "</b></br>" +
                                    getInnerHtml("Name", indexAuthor) +
                                    getInnerHtml("Prenume", indexAuthor) +
                                    getInnerHtml("Asociation", indexAuthor) +
                                    getInnerHtml("Organization", indexAuthor) +
                                    getInnerHtml("University", indexAuthor) +
                                    getInnerHtml("Faculty", indexAuthor) +
                                    getInnerHtml("Email", indexAuthor) + "</br>";

              document.getElementById('authors').appendChild(newdiv);
           }
         }

      //]]>
    </script>


    <br></br>
    <input type="submit" value="Submit" title="Submit info" />
  </form>

{{/html}}

#if("$!request.titlu" != '')

  #set($presentationUpload=$services.presrequest.getPresentationUploadInstance())
  #set($presentation=$services.presrequest.getPresentationInstance())
  #set($uploadInfo=$services.presrequest.getUploadInfoInstance())

  $presentation.setTitle($request.titlu)
  ##$presentation.setContent($request.filepath)   ??? TODO
  $uploadInfo.setDescription($request.description)

  #set($intString="$!request.nrauthors")
  #set($Integer = 0)
  #set($end = $Integer.parseInt($intString))
  #set($start=1)

  #foreach($index in [$start..$end])
    #set($author=$services.presrequest.getAuthorInstance())

    #set($requestField = "$request.name" + $index)
    $author.setLastName("#evaluate($requestField)")

    #set($requestField = "$request.prenume" + $index)
    $author.setFirstName("#evaluate($requestField)")

    #set($requestField = "$request.asociation" + $index)
    $author.setAssociation("#evaluate($requestField)")

    #set($requestField = "$request.organization" + $index)
    $author.setOrganization("#evaluate($requestField)")

    #set($requestField = "$request.university" + $index)
    $author.setUniversity("#evaluate($requestField)")

    #set($requestField = "$request.faculty" + $index)
    $author.setFaculty("#evaluate($requestField)")

    #set($requestField = "$request.email" + $index)
    $author.setEmail("#evaluate($requestField)")

   
{{html}}

<table>
<tr>
    <th>Titlu</th>
    <th>Name</th>
    <th>Prenume</th>
    <th>Association</th>
    <th>Organization</th>
    <th>University</th>
    <th>Faculty</th>
    <th>Email</th>
    </th>
</tr>


    <tr>
        <td>$presentation.getTitle()</td>        
        <td>$author.getLastName()</td>
        <td>$author.getFirstName()</td>
        <td>$author.getAssociation()</td>
        <td>$author.getOrganization()</td>
        <td>$author.getUniversity()</td> 
        <td>$author.getFaculty()</td> 
        <td>$author.getEmail()</td> 
    </tr>
</table>
{{/html}}

    $uploadInfo.addAuthor($author)
  #end

  $presentationUpload.setPresentation($presentation)
  $presentationUpload.setUploadInfo($uploadInfo)

  $services.presrequest.uploadWork($presentationUpload)


#end
{{/velocity}}


 
